

CREATE TABLE Monasteries(
	Id INT  PRIMARY KEY IDENTITY
	,[Name] NVARCHAR(125) NOT NULL
	,CountryCode CHAR(2) NOT NULL FOREIGN KEY REFERENCES Countries(CountryCode)
)

ALTER TABLE Countries
ADD IsDeleted BIT NOT NULL DEFAULT 0


UPDATE Countries
SET IsDeleted = 1
WHERE CountryCode IN (
						SELECT 
							c.CountryCode
						FROM Countries AS c
						LEFT JOIN CountriesRivers AS cr
						   ON c.CountryCode=cr.CountryCode
						LEFT JOIN Rivers AS r
							ON cr.RiverId=r.Id
						GROUP BY c.CountryCode
						HAVING COUNT(r.RiverName)>3
						)
						
SELECT 
	m.[Name] AS Monastery
	,c.CountryName AS Country
FROM Monasteries AS m
left JOIN Countries AS c
  ON c.CountryCode=m.CountryCode
WHERE c.IsDeleted = 0
ORDER BY m.[Name]

